{% extends "AcmeAuthBundle::layout.html.twig" %}
    {% block title "Расписание занятий" %}
        {% block content %}
            <script type="text/javascript" src="{{ asset('bundles/js/schedule/dhtmlxscheduler.js') }}" media="screen" title="no title" charset="utf-8"></script>
            <script type="text/javascript" src="{{ asset('bundles/js/schedule/locale/locale_ru.js') }}" media="screen" title="no title" charset="utf-8"></script>
            <script type="text/javascript" src="{{ asset('bundles/js/schedule/ext/dhtmlxscheduler_editors.js') }}" media="screen" title="no title" charset="utf-8"></script>
            <script type="text/javascript" src="{{ asset('bundles/js/schedule/dhtmlxCombo/dhtmlxcombo.js') }}" media="screen" title="no title" charset="utf-8"></script>
            <script type="text/javascript" src="{{ asset('bundles/js/select2.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('bundles/js/sorting_select2.js') }}"></script>
            <link rel="stylesheet" href="{{ asset('bundles/css/schedule/dhtmlxscheduler.css') }}" charset="utf-8" />
            <link rel="stylesheet" href="{{ asset('bundles/js/schedule/dhtmlxCombo/dhtmlxcombo.css') }}" charset="utf-8" />
            <link rel="stylesheet" href="{{ asset('bundles/css/select2.css') }}"/>
            <div class="container">
                <style>
                    .dhtmlx_popup_text {
                        font-size: 13px;
                    }
                    .dhtmlx_popup_button {
                        height: 35px;
                    }
                    .dhx_scale_hour{
                        line-height:normal;
                    }
                </style>
                <div class="row">
                    <div class="btn-group" data-toggle-name="profile_options" data-toggle="buttons-radio">
                        <button type="button" value="profile" data-toggle="button" class="btn btn-primary active">Расписание занятий</button>
                        <button type="button" value="messages" data-toggle="button" class="btn btn-primary">Расписание сессии и доп. занятий</button>
                    </div>
                </div>
                <div class="row">
                    <div class="btn-group" data-toggle-name="messages_options" data-toggle="buttons-radio">
                        <button type="button" value="support" data-toggle="button" class="btn btn-primary active">По группе</button>
                        <button type="button" value="private" data-toggle="button" class="btn btn-primary active">По преподавателю</button>
                        <button type="button" value="chair" data-toggle="button" class="btn btn-primary active">По предмету</button>
                        <button type="button" value="chair" data-toggle="button" class="btn btn-primary active">По аудитории</button>
                        <input id="messages-options" type="hidden">
                    </div>
                </div>
                <div class="row">
                    <div id="scheduler_here" class="dhx_cal_container" style='width:100%; height:1200px;'>
                        <div class="dhx_cal_navline">
                            <div class="dhx_cal_prev_button">&nbsp;</div>
                            <div class="dhx_cal_next_button">&nbsp;</div>
                            <div class="dhx_cal_today_button"></div>
                            <div class="dhx_cal_date"></div>
                            <div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div>
                            <div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div>
                            <div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div>
                        </div>
                        <div class="dhx_cal_header">
                        </div>
                        <div class="dhx_cal_data">
                        </div>
                    </div>
                </div>
            </div>
            <script>
                jQuery(function ($) {
                    $.fn.button.noConflict();
                    $(".js-example-basic-multiple").select2();

                    var step = 30, format = scheduler.date.date_to_str("%H:%i");
                    scheduler.config.xml_date="%Y-%m-%d %H:%i";
                    scheduler.config.first_hour = 8;
                    scheduler.config.last_hour = 21;
                    scheduler.config.time_step = 10;
                    scheduler.config.separate_short_events = true;
                    scheduler.config.auto_end_date = true;
                    scheduler.config.details_on_create = true;
                    scheduler.config.details_on_dblclick = true;
                    scheduler.config.hour_size_px = (60 / step) * 22;
                    scheduler.config.limit_time_select = true;
                    //scheduler.config.event_duration = 60;
                    scheduler.locale.labels.section_check_divide = "Разделить на 2 подгруппы";
                    scheduler.locale.labels.section_check_full = "Заполнить на последующие недели";
                    //scheduler.locale.labels.section_template = 'Details';
                    scheduler.locale.labels.section_subject = "Предмет";
                    scheduler.config.lightbox.sections = [
                        {name: "description", height: 100, map_to: "text", type: "textarea", focus: true},
                        {name: "check_divide", map_to: "even", type: "checkbox", checked_value: "1", unchecked_value: "0", height: 40},
                        {name: "check_full", map_to: "odd", type: "checkbox", checked_value: "1", unchecked_value: "0", height: 40},
                        /*{name:"reccuring", height:21, type:"select", map_to:"rec_type", options:[
                            {key:"", label:"Do not repeat"},
                            {key:"day", label:"Each day"},
                            {key:"week", label:"Each week"},
                            {key:"month", label:"Each month"}
                        ]},*/
                       // {name: "template", height: 40, type: "template", map_to: "my_template"},
                        { name:"subject",/* options:[
                                { key: 1, label: 'James' },
                                { key: 2, label: 'Alex' },
                                { key: 3, label: 'Antony' },
                                { key: 4, label: 'Andrew' }
                            ],*/ map_to: "subject", type: "combo", image_path: "{{ asset('bundles/js/schedule/dhtmlxCombo/imgs/') }}", height: 30, filtering: true},
                        {name: "time", height: 72, type: "time", map_to: "auto"}
                    ];
                  /*  scheduler.attachEvent("onEventCreated", function(id, e) {
                        *//*var ev = scheduler.getEvent(id);
                        ev.my_template = "<b>Holder:</b>"+ ev.holder+"<br><b>Room:</b>"+ ev.room;*//*
                        var ev = scheduler.getEvent(id);
                        *//*$(".js-example-basic-multiple").select2({
                            placeholder: "Выберите предмет",
                            allowClear: true,
                            width: 300,
                            maximumSelectionSize: 2,
                            formatNoMatches: "Не найден такой предмет",
                            sortResults: sortingResults
                        }).on("select2-selecting", function(e) {
                            var selectorSubject = $("#formCreateOrder_selectorSubject");
                             hidePopover(selectorSubject);
                        });*//*
                        ev.my_template = '<select class="js-example-basic-multiple" multiple="multiple">'+
                                '<option value="AL">Alabama</option>'+
                                '<option value="WY">Wyoming</option>'+
                                '</select>';
                    });*/
                    scheduler.templates.hour_scale = function(date){
                        var html = "";
                        for (var i = 0; i < 60 / step; i++){
                            html += "<div style='height:22px;line-height:22px;'>" + format(date) + "</div>";
                            date = scheduler.date.add(date, step, "minute");
                        }
                        return html;
                    };
                    scheduler.init('scheduler_here', null, "week");
                    scheduler.load("schedule/data");
                    var dp = new dataProcessor("schedule/data");
                    dp.init(scheduler);



                    //$("#formProfile_fieldOptions").val('profile');
                    //$("#messages-options").val('profile');
                    $('div.btn-group[data-toggle-name]').eq(0).each(function () {
                        var group = $(this),
                        //form = group.parents('form').eq(0),
                                name = 'formProfile[fieldOptions]',
                        //hidden = $('input[name="' + name + '"]', form);
                                hidden = $('input[name="' + name + '"]');
                        $('button', group).each(function () {
                            var button = $(this);
                            button.live('click', function () {
                                hidden.val($(this).val());
                                group.find('.active').removeClass('active');
                                if (button.val() == hidden.val()) {
                                    button.addClass('active');
                                }
                                if (hidden.val() == 'messages') {
                                    initGridMessages();
                                    $("#block-form-profile").hide();
                                    $("#block-messages").show();
                                    $("#block-messages-sort").show();
                                } else {
                                    $("#block-form-profile").show();
                                    $("#block-messages").hide();
                                    $("#block-talk").hide();
                                    $("#block-messages-sort").hide();
                                }
                            });
                        });
                    });
                    $('div.btn-group[data-toggle-name]').eq(1).each(function () {
                        var group = $(this),
                        //form = group.parents('form').eq(0),
                                name = 'formProfile[fieldOptions]',
                        //hidden = $('input[name="' + name + '"]', form);
                                hidden = $('input[name="' + name + '"]');
                        group.find('.active').removeClass('active');
                        $('button', group).each(function () {
                            var button = $(this);
                            button.live('click', function () {
                                hidden.val($(this).val());
                                group.find('.active').removeClass('active');
                                if (button.val() == hidden.val()) {
                                    button.addClass('active');
                                }
                            });
                        });
                    });
                });
            </script>
        {% endblock %}